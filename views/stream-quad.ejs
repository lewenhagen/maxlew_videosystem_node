<!DOCTYPE html>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    .grid-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      height: 100vh;
    }

    .camera-feed {
      width: 100%;
      height: 100%;
      object-fit: cover;
    } 
  </style>
<body>
  
  <div class="grid-container">
    <div id="one"><img id="1" class=" camera-feed" alt="Cam feed 1" src=""/> </div>
    <div id="two"><img id="2" class=" camera-feed" alt="Cam feed 2" src=""/> </div>
    <div id="three"><img id="3" class=" camera-feed" alt="Cam feed 3" src=""/></div>
    <div id="four"><img id="4" class=" camera-feed" alt="Cam feed 4" src=""/></div>
  </div>
  
</body>
  <script type="module">
    const delay = parseInt('<%= delay %>')
    const delta = parseInt('<%= delta %>')
    const url = '<%= url %>'

    async function updateStreams(initialDelay, delta) {
      
      const maxDelay = 36; // Maximum allowed delay
      const sleep = (ms) => new Promise((resolve) => setTimeout(resolve, ms));
      const delay = Math.min(initialDelay, maxDelay);
      const second = Math.min(delay + delta, maxDelay);
      const third = Math.min(delay + delta * 2, maxDelay);
      const fourth = Math.min(delay + delta * 3, maxDelay);

      const delays = [delay, second, third, fourth];
      const elements = [
        document.getElementById("1"),
        document.getElementById("2"),
        document.getElementById("3"),
        document.getElementById("4"),
      ];

      for (let i = 0; i <= fourth; i++) { 
        elements.forEach((element, index) => {
          if (!element) {
            console.error(`Element with ID ${index + 1} not found!`);
            return; 
          }

          const currentDelay = delays[index];

          if (i < currentDelay) {
            element.src = `img/hourglass/${currentDelay - i}.jpg`;
          } else if (element.src !== `http://localhost:3000/stream/stream${index + 1}/${currentDelay}`) {
            element.src = `http://localhost:3000/stream/stream${index + 1}/${currentDelay}`;
          }
        })
        await sleep(1000)
      }
    }

    await updateStreams(delay, delta)

    document.addEventListener("keydown", function(event) {
      let key = event.key
      if (key == "+") {
        window.location.replace("/", true)
      }
    })
  </script>
  